#!/bin/bash

env_file="$HOME/.config/alx/env"

if [ ! -f "$env_file" ]; then
    # Create this file for first use
    line="venv=$(dirname $(dirname $(which python)))"
    echo "NOTE: *** Creating $env_file with: $line"
    echo $line > $env_file
fi

# Load the venv=... setting
. "$env_file"

# Validate venv path
if [ -z "$venv" ] || [ ! -x "$venv/bin/python" ]; then
    echo "Invalid venv path: $venv"
    echo "Check $env_file for correctness"
    exit 1
fi

# Add venv bin to PATH
export PATH="$venv/bin:$PATH"

dir=$(dirname "$0")
app=$(basename "$0")
start=$dir"/../scripts/"$app

if [ "$dir" == "." ]; then
    dir=$(pwd)
fi

# Run the app
if [ ! -f "$start/$app.py" ]; then
    echo "Cannot find $start/$app.py"
    exit 1
fi

cd "$start" || exit 1
start=$(pwd)

exec python $start/$app.py "$@"

exit 0
